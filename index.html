<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Condom Mint | NFT</title>

<!-- Farcaster Mini App Meta Tag -->
<meta name="fc:miniapp" content='{
  "version":"1",
  "imageUrl":"https://your-domain.vercel.app/preview.png",
  "button":{
    "title":"Mint NFT",
    "action":{
      "type":"launch_frame",
      "name":"Condom Mint",
      "url":"https://your-domain.vercel.app/",
      "splashImageUrl":"https://your-domain.vercel.app/icon.png",
      "splashBackgroundColor":"#ec4899"
    }
  }
}'>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100dvh;
  overflow: hidden;
}
body {
  background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  box-sizing: border-box;
}
.container {
  max-width: 320px;
  width: 100%;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(8px);
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  text-align: center;
}
h1 {
  font-size: 1.8rem;
  margin-bottom: 6px;
  font-weight: 800;
  background: linear-gradient(135deg, #fff 0%, #f9a8d4 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.subtitle {
  font-size: 0.9rem;
  opacity: 0.9;
  margin-bottom: 20px;
  color: #fbcfe8;
}
.nft-preview {
  width: 140px;
  height: 140px;
  margin: 0 auto 16px;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 64px;
  border: 2px solid rgba(255,255,255,0.3);
}
.wallet-info {
  display: none;
  background: rgba(0,0,0,0.25);
  border-radius: 10px;
  padding: 10px;
  margin-bottom: 16px;
}
.wallet-info.show { display: block; }
.wallet-address {
  font-size: 0.8rem;
  font-weight: 600;
  color: #c4b5fd;
  word-break: break-all;
}
.btn {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg,#fff 0%,#f9a8d4 100%);
  color: #db2777;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  font-size: 0.95rem;
  cursor: pointer;
  margin: 8px 0;
  transition: all 0.3s;
}
.btn:hover { transform: translateY(-2px); }
.btn:disabled { background: rgba(255,255,255,0.2); color: #aaa; }
.btn-secondary {
  background: rgba(255,255,255,0.1);
  color: #fff;
  border: 2px solid rgba(255,255,255,0.3);
}
.status-message {
  margin-top: 12px;
  font-size: 0.8rem;
  display: none;
}
.status-message.show { display: block; }
.status-message.success { color: #6ee7b7; }
.status-message.error { color: #fca5a5; }
</style>
</head>

<body>
<div class="container">
  <h1>Condom Mint üçåüõ°Ô∏è</h1>
  <p class="subtitle">Mint Your Exclusive Safe Badge</p>

  <div class="nft-preview">üçå</div>

  <div id="walletInfo" class="wallet-info">
    <div class="wallet-address" id="walletAddress"></div>
  </div>

  <button id="connectBtn" class="btn">Connect Wallet</button>
  <button id="mintBtn" class="btn" disabled>Mint NFT</button>

  <div id="shareSection" style="display:none;">
    <button id="shareCastBtn" class="btn btn-secondary">Share on Farcaster üöÄ</button>
  </div>

  <div id="statusMessage" class="status-message"></div>
</div>

<script type="module">
import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk@0.1.8';
import { createConfig, connect, writeContract, getAccount, http } from 'https://esm.sh/@wagmi/core@2.13.5';
import { base } from 'https://esm.sh/@wagmi/core@2.13.5/chains';
import { farcasterMiniApp } from 'https://esm.sh/@farcaster/miniapp-wagmi-connector@0.1.7';

const NFT_CONTRACT_ADDRESS = "0xEa6a0959F2c169c1Be1eFDc884B6920AE36D41A3";
const NFT_CONTRACT_ABI = [
  { "inputs": [], "name": "mint", "outputs": [], "stateMutability": "nonpayable", "type": "function" }
];

const connectBtn = document.getElementById("connectBtn");
const mintBtn = document.getElementById("mintBtn");
const walletInfo = document.getElementById("walletInfo");
const walletAddress = document.getElementById("walletAddress");
const statusMessage = document.getElementById("statusMessage");
const shareSection = document.getElementById("shareSection");
const shareCastBtn = document.getElementById("shareCastBtn");

let userWalletAddress = null;

// Wagmi Config
const wagmiConfig = createConfig({
  chains: [base],
  transports: { [base.id]: http() }
});

function showStatus(msg, type="info") {
  statusMessage.textContent = msg;
  statusMessage.className = `status-message show ${type}`;
  setTimeout(()=>statusMessage.classList.remove("show"), 4000);
}

// Connect Wallet
connectBtn.onclick = async () => {
  try {
    connectBtn.disabled = true;
    connectBtn.innerText = "Connecting...";
    const account = await connect(wagmiConfig, { connector: farcasterMiniApp() });
    userWalletAddress = account.accounts[0];
    if (userWalletAddress) {
      walletAddress.innerText = userWalletAddress.slice(0,6)+"..."+userWalletAddress.slice(-4);
      walletInfo.classList.add("show");
      connectBtn.style.display = "none";
      mintBtn.disabled = false;
      showStatus("‚úÖ Wallet Connected", "success");
    }
  } catch (e) {
    console.error(e);
    connectBtn.disabled = false;
    connectBtn.innerText = "Connect Wallet";
    showStatus("‚ùå Wallet connect failed", "error");
  }
};

// Mint NFT
mintBtn.onclick = async () => {
  if (!userWalletAddress) return showStatus("‚ùå Connect wallet first", "error");
  try {
    mintBtn.disabled = true;
    mintBtn.innerText = "Minting...";
    const txHash = await writeContract(wagmiConfig, {
      address: NFT_CONTRACT_ADDRESS,
      abi: NFT_CONTRACT_ABI,
      functionName: "mint"
    });
    mintBtn.innerText = "Minted üéâ";
    shareSection.style.display = "block";
    showStatus(`üéâ Minted! View TX on BaseScan`, "success");
  } catch (e) {
    console.error(e);
    mintBtn.disabled = false;
    mintBtn.innerText = "Mint NFT";
    showStatus("‚ùå Mint failed", "error");
  }
};

// Share
shareCastBtn.onclick = async () => {
  await sdk.actions.composeCast({
    text: "Just minted my Condom NFT üçåüõ°Ô∏è on Farcaster! #StaySafe",
    embeds: [window.location.href]
  });
};
</script>
</body>
</html>
